---
phase: 08-design-ui-system
plan: 04
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - IP/styles/font_profiles.py
  - IP/styles/orchestr8.css
  - IP/features/maestro/config.py
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Font profile dropdown shows Phreak fonts (Marcellus SC, Poiret One, VT323)"
    - "Phreak fonts load via Google Fonts CDN"
    - "Font selection persists to pyproject_orchestr8_settings.toml"
    - "CSS uses --font-header, --font-ui, --font-data variables"
  artifacts:
    - path: "IP/styles/font_profiles.py"
      provides: "Phreak font profile definitions"
      contains: "phreak_nexus"
    - path: "IP/styles/orchestr8.css"
      provides: "Phreak typography CSS variables"
      contains: "--font-header.*Marcellus"
  key_links:
    - from: "font_profiles.py"
      to: "orchestr8.css"
      via: "CSS variable injection"
      pattern: "--font-header.*--font-ui"
---

<objective>
Migrate typography from current HardCompn/CalSans/Mini Pixel to Phreak fonts (Marcellus SC, Poiret One, VT323) as specified in PHREAK_CSE_RESEARCH_REPORT.md.

Purpose: The Phreak aesthetic requires specific typography per orchestr8_ui_reference.html. Current font_profiles.py uses legacy fonts. This plan implements the LOCKED typography specification.
</objective>

<execution_context>
@/home/bozertron/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bozertron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@IP/styles/font_profiles.py - Current font profile definitions
@IP/styles/orchestr8.css - Current CSS with legacy font variables
@SOT/CODEBASE_TODOS/PHREAK_CSE_RESEARCH_REPORT.md - Typography lock spec
@mingos_settlement_lab/Human Dashboard Aesthetic Reference/orchestr8_ui_reference.html - Source typography
@.planning/phases/08-design-ui-system/08-01-PLAN.md - Depends on CSS foundation
</context>

<tasks>

<task type="auto">
  <name>Add Phreak font profile to font_profiles.py</name>
  <files>IP/styles/font_profiles.py</files>
  <action>
    Add Phreak font profile using Google Fonts CDN:

    1. Add Google Fonts URL to fetch:
       ```
       https://fonts.googleapis.com/css2?family=Marcellus+SC&family=Poiret+One&family=VT323&display=swap
       ```

    2. Add new profile definition "phreak_nexus":
       ```python
       "phreak_nexus": {
           "label": "Phreak Nexus (Marcellus SC + Poiret One + VT323)",
           "headline": "'Marcellus SC', serif",
           "body": "'Poiret One', cursive",
           "mono": "'VT323', monospace",
       },
       ```

    3. Modify _build_font_face to fetch from Google Fonts CDN for these web fonts:
       - Marcellus SC: serif, elegant headers
       - Poiret One: cursive, UI labels
       - VT323: monospace, data/terminal

    4. Add Google Fonts @import to the generated CSS:
       ```python
       @import url('https://fonts.googleapis.com/css2?family=Marcellus+SC&family=Poiret+One&family=VT323&display=swap');
       ```

    5. Update DEFAULT_FONT_PROFILE to "phreak_nexus" if this is the preferred aesthetic

    6. Keep existing profiles (regal_deco, deco_console, clean_utility) for backwards compatibility
  </action>
  <verify>
    python -c "
from IP.styles.font_profiles import _PROFILE_DEFINITIONS
assert 'phreak_nexus' in _PROFILE_DEFINITIONS
assert 'Marcellus' in _PROFILE_DEFINITIONS['phreak_nexus']['headline']
print('Phreak profile OK')
"
  </verify>
  <done>
    font_profiles.py includes phreak_nexus profile with correct Google Fonts
  </done>
</task>

<task type="auto">
  <name>Update orchestr8.css typography variables</name>
  <files>IP/styles/orchestr8.css</files>
  <action>
    Update CSS typography variables to use Phreak naming convention:

    1. Add Phreak-specific font variables alongside existing:
       ```css
       /* Phreak Typography (per orchestr8_ui_reference.html) */
       --font-header: 'Marcellus SC', serif;
       --font-ui: 'Poiret One', cursive;
       --font-data: 'VT323', monospace;
       ```

    2. Keep legacy variables for backwards compatibility but mark as deprecated:
       ```css
       /* Legacy - deprecated, use --font-header/body/data instead */
       --font-headline: var(--font-header);
       --font-body: var(--font-ui);
       --font-mono: var(--font-data);
       ```

    3. Add Phreak-specific component styles:
       ```css
       /* Phreak Button Styles */
       .btn-phreak {
           font-family: var(--font-data);
           font-style: italic;
           color: var(--gold-metallic);
           border: 1px solid var(--gold-dark);
           background: transparent;
           padding: 8px 16px;
           cursor: pointer;
           transition: all 0.2s ease;
       }
       
       .btn-phreak:hover {
           background: var(--gold-metallic);
           color: var(--bg-primary);
       }
       
       /* Phreak Input */
       .input-phreak {
           font-family: var(--font-ui);
           color: var(--text-primary);
           background: transparent;
           border: none;
           border-bottom: 1px solid rgba(255,255,255,0.3);
           padding: 8px 0;
           outline: none;
       }
       
       .input-phreak:focus {
           border-bottom-color: var(--blue-dominant);
       }
       ```

    4. Add header/footer spacing per reference:
       ```css
       /* Phreak Layout Dimensions */
       --header-height: 80px;
       --top-btn-height: 50px;
       --top-btn-min-width: 160px;
       --footer-mini-btn-height: 22px;
       --footer-mini-btn-min-width: 60px;
       ```
  </action>
  <verify>
    grep -q "font-header.*Marcellus" IP/styles/orchestr8.css && \
    grep -q "phreak" IP/styles/orchestr8.css
  </verify>
  <done>
    orchestr8.css has Phreak typography variables and component styles
  </done>
</task>

<task type="auto">
  <name>Wire font profile to settings persistence</name>
  <files>IP/features/maestro/config.py</files>
  <action>
    Ensure font profile selection persists via TOML:

    1. Verify get_ui_font_profile() reads from correct TOML path:
       - Path: pyproject_orchestr8_settings.toml
       - Key: ui.general.font_profile

    2. Add font_profile to available options in settings if not present:
       - Check pyproject_orchestr8_settings.toml structure
       - Ensure ui.general.font_profile key exists

    3. Test persistence flow:
       - Select phreak_nexus in UI
       - Verify writes to TOML
       - Verify reload restores selection
  </action>
  <verify>
    python -c "
from IP.features.maestro.config import get_ui_font_profile
profile = get_ui_font_profile()
print(f'Current font profile: {profile}')
"
  </verify>
  <done>
    Font profile selection persists to TOML and loads on startup
  </done>
</task>

</tasks>

<verification>
1. Run `marimo run orchestr8.py` 
2. Check Settings UI shows "Phreak Nexus" in font profile dropdown
3. Select Phreak Nexus - fonts should change immediately (preview)
4. Save settings - persists to TOML
5. Reload page - font selection restored
6. Verify console shows no font loading errors
</verification>

<success_criteria>
- Phreak fonts (Marcellus SC, Poiret One, VT323) load correctly
- Font profile dropdown includes phreak_nexus option
- Selection persists across page reloads
- CSS uses --font-header, --font-ui, --font-data consistently
</success_criteria>

<output>
After completion, create `.planning/phases/08-design-ui-system/08-04-SUMMARY.md`
</output>
