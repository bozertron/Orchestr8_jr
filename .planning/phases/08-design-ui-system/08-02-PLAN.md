---
phase: 08-design-ui-system
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - IP/plugins/07_settings.py
  - pyproject_orchestr8_settings.toml
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Settings schema validated on load"
    - "Invalid values rejected before save"
    - "Type hints enable IDE autocomplete"
    - "Tauri-ready schema structure"
  artifacts:
    - path: "IP/plugins/07_settings.py"
      provides: "Pydantic-validated settings with toml persistence"
      contains: "from pydantic import"
  key_links:
    - from: "SettingsManager"
      to: "Pydantic models"
      via: "validation on load/save"
      pattern: "model_validate.*settings"
---

<objective>
Add Pydantic models for settings validation. Current SettingsManager uses raw TOML dicts - this creates type-unsafe access and no validation. Pydantic models will enable Tauri packaging readiness per research recommendation.

Purpose: Research scored EPO Settings 23/25 and recommends ACQUIRE_NOW. Pydantic validation ensures settings integrity and enables future Tauri integration.
</objective>

<execution_context>
@/home/bozertron/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/bozertron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@IP/plugins/07_settings.py - Current SettingsManager implementation
@pyproject_orchestr8_settings.toml - Current settings structure
@.planning/phases/08-design-ui-system/08-RESEARCH.md - Research recommendations
</context>

<tasks>

<task type="auto">
  <name>Add Pydantic settings models to 07_settings.py</name>
  <files>IP/plugins/07_settings.py</files>
  <action>
    Add Pydantic models for type-safe settings validation:

    1. Import Pydantic at top:
       ```python
       from pydantic import BaseModel, Field, field_validator
       from typing import Optional, List, Dict, Any
       ```

    2. Create nested model classes matching TOML structure:
       - `AgentConfig` - For each agent (director, professor, doctor)
       - `ToolConfig` - For each tool (actu8, senses, cre8, etc.)
       - `UIConfig` - UI preferences
       - `LoggingConfig` - Logging settings
       - `Orchestr8Settings` - Root model containing all sections

    3. Add field validators for:
       - check_interval_seconds (must be positive)
       - font_size (range 8-24)
       - model names (valid enum or pattern)

    4. Modify SettingsManager to:
       - Use Pydantic models for validation on load
       - Serialize to TOML for persistence
       - Keep backwards compatibility with existing TOML files

    5. Example model structure:
       ```python
       class AgentDirectorConfig(BaseModel):
           enabled: bool = False
           check_interval_seconds: int = Field(default=30, ge=1)
           stuck_threshold_minutes: int = Field(default=5, ge=1)
           max_concurrent_generals: int = Field(default=10, ge=1)
           
       class Orchestr8Settings(BaseModel):
           agents: Dict[str, Any] = {}
           tools: Dict[str, Any] = {}
           ui: Dict[str, Any] = {}
           # ... etc
       ```
  </action>
  <verify>
    python -c "
from IP.plugins.seven_settings import Orchestr8Settings
print('Pydantic models import OK')
" 2>&1 | head -5
  </verify>
  <done>
    SettingsManager uses Pydantic models with validation
  </done>
</task>

<task type="auto">
  <name>Add real-time settings preview</name>
  <files>IP/plugins/07_settings.py</files>
  <action>
    Implement real-time preview for settings changes:

    1. Add live preview for UI settings:
       - Font profile changes apply immediately (re-render)
       - Theme changes show instant preview
       - Animation speed changes visible

    2. Use mo.state for preview state:
       - Track which settings have preview mode
       - Apply changes without full page reload

    3. For font profile specifically:
       - When user selects new font profile in dropdown
       - Immediately trigger font_profiles.py re-injection
       - User sees change instantly

    4. Add preview indicator:
       - Show "Previewing..." badge when unsaved changes exist
       - Clear indicator after save
  </action>
  <verify>
    grep -q "font_profile" IP/plugins/07_settings.py && \
    grep -q "preview" IP/plugins/07_settings.py
  </verify>
  <done>
    Settings changes apply immediately without save
  </done>
</task>

</tasks>

<verification>
1. Load orchestr8.py - Settings tab shows
2. Change font profile - See immediate font change
3. Add invalid value (negative interval) - Should reject on save
4. Save settings - Persists to TOML correctly
5. Load corrupted TOML - Shows validation error, doesn't crash
</verification>

<success_criteria>
- Pydantic models validate all settings on load
- Invalid values rejected with clear error messages
- Font profile changes apply in real-time
- IDE autocomplete works for settings keys
</success_criteria>

<output>
After completion, create `.planning/phases/08-design-ui-system/08-02-SUMMARY.md`
</output>
